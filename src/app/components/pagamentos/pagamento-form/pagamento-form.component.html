<div class="container mt-4" *ngIf="cliente">
  <div class="card">
    <div class="card-header">
      <h3>{{ isEditMode ? 'Editar Pagamento' : 'Novo Pagamento' }}</h3>
      <p class="mb-0 text-muted">Cliente: {{ cliente.nome }}</p>
    </div>
    <div class="card-body">
      <form [formGroup]="pagamentoForm" (ngSubmit)="onSubmit()">
        
        <div class="row">
          <div class="col-md-4 mb-3">
            <label for="valorPago" class="form-label">Valor Pago *</label>
            <div class="input-group">
              <span class="input-group-text">R$</span>
              <input 
                type="text" 
                class="form-control no-spinners" 
                id="valorPago" 
                formControlName="valorPago"
                mask="separator.2"
                thousandSeparator="."
                separatorLimit="9999999"
                [class.is-invalid]="f['valorPago'].invalid && f['valorPago'].touched">
              <div class="invalid-feedback" *ngIf="f['valorPago'].invalid && f['valorPago'].touched">
                <div *ngIf="f['valorPago'].errors?.['required']">Valor é obrigatório</div>
                <div *ngIf="f['valorPago'].errors?.['min']">Valor deve ser maior que zero</div>
              </div>
            </div>
          </div>

          <div class="col-md-4 mb-3">
            <label for="dataVencimento" class="form-label">Data de Vencimento *</label>
            <input 
              type="date" 
              class="form-control" 
              id="dataVencimento" 
              formControlName="dataVencimento"
              [class.is-invalid]="f['dataVencimento'].invalid && f['dataVencimento'].touched">
            <div class="invalid-feedback" *ngIf="f['dataVencimento'].invalid && f['dataVencimento'].touched">
              Data de vencimento é obrigatória
            </div>
          </div>

          <div class="col-md-4 mb-3">
            <label for="dataPagamento" class="form-label">Data do Pagamento *</label>
            <input 
              type="date" 
              class="form-control" 
              id="dataPagamento" 
              formControlName="dataPagamento"
              [class.is-invalid]="f['dataPagamento'].invalid && f['dataPagamento'].touched">
            <div class="invalid-feedback" *ngIf="f['dataPagamento'].invalid && f['dataPagamento'].touched">
              Data do pagamento é obrigatória
            </div>
          </div>
        </div>

        <div class="row" *ngIf="diasAtraso > 0">
          <div class="col-12 mb-3">
            <div class="alert alert-warning">
              <i class="bi bi-exclamation-triangle"></i>
              <strong>Atenção:</strong> Este pagamento está com <strong>{{ diasAtraso }} dia(s) de atraso</strong>.
            </div>
          </div>
        </div>

        <div class="mb-3">
          <label for="observacao" class="form-label">Observação</label>
          <textarea 
            class="form-control" 
            id="observacao" 
            formControlName="observacao"
            rows="3"
            placeholder="Adicione uma observação (opcional)"></textarea>
        </div>

        <div class="d-flex justify-content-end gap-2 mt-4">
          <button type="button" class="btn btn-secondary" (click)="cancelar()">
            Cancelar
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="pagamentoForm.invalid">
            {{ isEditMode ? 'Atualizar' : 'Registrar Pagamento' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
