<div class="form-container">
  <!-- Header Section -->
  <div class="header-section">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-8">
          <h1 class="page-title">
            <i class="bi bi-person-plus me-3"></i>
            {{ isEditMode ? 'Editar Cliente' : 'Novo Cliente' }}
          </h1>
          <p class="page-subtitle">{{ isEditMode ? 'Atualize as informações do cliente' : 'Cadastre um novo cliente no
            sistema' }}</p>
        </div>
        <div class="col-lg-4 text-lg-end">
          <div class="form-progress">
            <div class="progress-circle" [class.active]="clienteForm.get('nome')?.value">
              <i class="bi bi-person"></i>
            </div>
            <div class="progress-line"></div>
            <div class="progress-circle" [class.active]="clienteForm.get('numeroContrato')?.value">
              <i class="bi bi-file-text"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container mt-4">
    <form [formGroup]="clienteForm" (ngSubmit)="onSubmit()" class="modern-form">
      <!-- Personal Information Section -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon personal">
            <i class="bi bi-person"></i>
          </div>
          <div class="section-title">
            <h4>Dados Pessoais</h4>
            <p>Informações básicas do cliente</p>
          </div>
        </div>

        <div class="section-content">
          <div class="row g-4">
            <div class="col-md-6">
              <div class="form-group">
                <label for="nome" class="form-label">
                  <i class="bi bi-person-badge me-2"></i>
                  Nome Completo *
                </label>
                <input type="text" class="form-control modern-input" id="nome" formControlName="nome"
                  placeholder="Digite o nome completo" [class.is-invalid]="f['nome'].invalid && f['nome'].touched">
                <div class="invalid-feedback" *ngIf="f['nome'].invalid && f['nome'].touched">
                  <div *ngIf="f['nome'].errors?.['required']">Nome é obrigatório</div>
                  <div *ngIf="f['nome'].errors?.['minlength']">Nome deve ter no mínimo 3 caracteres</div>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-group">
                <label for="cpf" class="form-label">
                  <i class="bi bi-card-text me-2"></i>
                  CPF *
                </label>
                <input type="text" class="form-control modern-input" id="cpf" formControlName="cpf"
                  mask="000.000.000-00" placeholder="000.000.000-00"
                  [class.is-invalid]="f['cpf'].invalid && f['cpf'].touched">
                <div class="invalid-feedback" *ngIf="f['cpf'].invalid && f['cpf'].touched">
                  CPF é obrigatório
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-group">
                <label for="telefone" class="form-label">
                  <i class="bi bi-telephone me-2"></i>
                  Telefone *
                </label>
                <input type="text" class="form-control modern-input" id="telefone" formControlName="telefone"
                  mask="(00) 00000-0000||(00) 0000-0000" placeholder="(00) 00000-0000"
                  [class.is-invalid]="f['telefone'].invalid && f['telefone'].touched">
                <div class="invalid-feedback" *ngIf="f['telefone'].invalid && f['telefone'].touched">
                  Telefone é obrigatório
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-group">
                <label for="email" class="form-label">
                  <i class="bi bi-envelope me-2"></i>
                  E-mail *
                </label>
                <input type="email" class="form-control modern-input" id="email" formControlName="email"
                  placeholder="exemplo@email.com" [class.is-invalid]="f['email'].invalid && f['email'].touched">
                <div class="invalid-feedback" *ngIf="f['email'].invalid && f['email'].touched">
                  <div *ngIf="f['email'].errors?.['required']">E-mail é obrigatório</div>
                  <div *ngIf="f['email'].errors?.['email']">E-mail inválido</div>
                </div>
              </div>
            </div>

            <div class="col-12">
              <div class="form-group">
                <label for="endereco" class="form-label">
                  <i class="bi bi-geo-alt me-2"></i>
                  Endereço Completo *
                </label>
                <textarea class="form-control modern-input" id="endereco" formControlName="endereco" rows="3"
                  placeholder="Digite o endereço completo com rua, número, bairro, cidade e CEP"
                  [class.is-invalid]="f['endereco'].invalid && f['endereco'].touched"></textarea>
                <div class="invalid-feedback" *ngIf="f['endereco'].invalid && f['endereco'].touched">
                  Endereço é obrigatório
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Contract Information Section -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon contract">
            <i class="bi bi-file-text"></i>
          </div>
          <div class="section-title">
            <h4>Dados do Contrato</h4>
            <p>Informações financeiras e contratuais</p>
          </div>
        </div>

        <div class="section-content">
          <div class="row g-4">
            <div class="col-md-6">
              <div class="form-group">
                <label for="numeroContrato" class="form-label">
                  <i class="bi bi-file-earmark-text me-2"></i>
                  Número do Contrato *
                </label>
                <input type="text" class="form-control modern-input" id="numeroContrato"
                  formControlName="numeroContrato" placeholder="Digite o número do contrato"
                  [class.is-invalid]="f['numeroContrato'].invalid && f['numeroContrato'].touched">
                <div class="invalid-feedback" *ngIf="f['numeroContrato'].invalid && f['numeroContrato'].touched">
                  Número do contrato é obrigatório
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-group">
                <label for="valorEntrada" class="form-label">
                  <i class="bi bi-cash-coin me-2"></i>
                  Valor da Entrada *
                </label>
                <div class="modern-input-group">
                  <input type="text" class="form-control modern-input no-spinners" id="valorEntrada"
                    formControlName="valorEntrada" mask="separator.2" thousandSeparator="." separatorLimit="999999999"
                    placeholder="0,00" [class.is-invalid]="f['valorEntrada'].invalid && f['valorEntrada'].touched">
                  <span class="input-prefix">R$</span>
                </div>
                <div class="invalid-feedback" *ngIf="f['valorEntrada'].invalid && f['valorEntrada'].touched">
                  <div *ngIf="f['valorEntrada'].errors?.['required']">Valor da entrada é obrigatório</div>
                  <div *ngIf="f['valorEntrada'].errors?.['entradaMaiorQueTotal']">Valor da entrada não pode ser maior
                    que o valor total</div>
                </div>
              </div>
            </div>
          </div>

          <div class="financial-grid">
            <div class="row g-4">
              <div class="col-md-4">
                <div class="form-group">
                  <label for="valorTotal" class="form-label">
                    <i class="bi bi-currency-dollar me-2"></i>
                    Valor Total *
                  </label>
                  <div class="modern-input-group">
                    <input type="text" class="form-control modern-input no-spinners" id="valorTotal"
                      formControlName="valorTotal" mask="separator.2" thousandSeparator="." separatorLimit="999999999"
                      placeholder="0,00" [class.is-invalid]="f['valorTotal'].invalid && f['valorTotal'].touched">
                    <span class="input-prefix">R$</span>
                  </div>
                  <div class="invalid-feedback" *ngIf="f['valorTotal'].invalid && f['valorTotal'].touched">
                    <div *ngIf="f['valorTotal'].errors?.['required']">Valor é obrigatório</div>
                    <div *ngIf="f['valorTotal'].errors?.['min']">Valor deve ser maior que zero</div>
                  </div>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-group">
                  <label for="numeroParcelas" class="form-label">
                    <i class="bi bi-list-ol me-2"></i>
                    Número de Parcelas *
                  </label>
                  <input type="text" class="form-control modern-input no-spinners" id="numeroParcelas"
                    formControlName="numeroParcelas" mask="0*" placeholder="Ex: 12"
                    [class.is-invalid]="f['numeroParcelas'].invalid && f['numeroParcelas'].touched">
                  <div class="invalid-feedback" *ngIf="f['numeroParcelas'].invalid && f['numeroParcelas'].touched">
                    <div *ngIf="f['numeroParcelas'].errors?.['required']">Número de parcelas é obrigatório</div>
                    <div *ngIf="f['numeroParcelas'].errors?.['min']">Deve ter no mínimo 1 parcela</div>
                  </div>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-group">
                  <label for="valorParcela" class="form-label">
                    <i class="bi bi-cash me-2"></i>
                    Valor da Parcela
                  </label>
                  <div class="modern-input-group">
                    <input type="text" class="form-control modern-input no-spinners calculated-field" id="valorParcela"
                      formControlName="valorParcela" readonly placeholder="Calculado automaticamente"
                      [class.is-invalid]="f['valorParcela'].invalid && f['valorParcela'].touched">
                    <span class="input-prefix">R$</span>
                  </div>
                  <small class="form-hint">
                    <i class="bi bi-info-circle me-1"></i>
                    Calculado automaticamente
                  </small>
                </div>
              </div>
            </div>
          </div>

          <div class="row g-4">
            <div class="col-md-6">
              <div class="form-group">
                <label for="dataPrimeiroVencimento" class="form-label">
                  <i class="bi bi-calendar-event me-2"></i>
                  Data do Primeiro Vencimento *
                </label>
                <input type="date" class="form-control modern-input" id="dataPrimeiroVencimento"
                  formControlName="dataPrimeiroVencimento"
                  [class.is-invalid]="f['dataPrimeiroVencimento'].invalid && f['dataPrimeiroVencimento'].touched">
                <div class="invalid-feedback"
                  *ngIf="f['dataPrimeiroVencimento'].invalid && f['dataPrimeiroVencimento'].touched">
                  <div *ngIf="f['dataPrimeiroVencimento'].errors?.['required']">Data do primeiro vencimento é
                    obrigatória</div>
                  <div *ngIf="f['dataPrimeiroVencimento'].errors?.['dateInPast']">Data não pode ser anterior à data
                    atual</div>
                </div>
                <small class="form-hint">
                  <i class="bi bi-info-circle me-1"></i>
                  Data específica para o vencimento da primeira parcela
                </small>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-group">
                <label for="estimativaValorPrevisto" class="form-label">
                  <i class="bi bi-graph-up me-2"></i>
                  Estimativa Valor Previsto/Mês
                </label>
                <div class="modern-input-group">
                  <input type="text" class="form-control modern-input no-spinners" id="estimativaValorPrevisto"
                    formControlName="estimativaValorPrevisto" mask="separator.2" thousandSeparator="."
                    separatorLimit="999999999" placeholder="0,00">
                  <span class="input-prefix">R$</span>
                </div>
                <small class="form-hint">
                  <i class="bi bi-info-circle me-1"></i>
                  Valor estimado de recebimento mensal
                </small>
              </div>
            </div>

            <div class="col-12">
              <div class="form-group">
                <label for="relatorioContratosPendentes" class="form-label">
                  <i class="bi bi-file-text me-2"></i>
                  Observações do Contrato
                </label>
                <textarea class="form-control modern-input" id="relatorioContratosPendentes"
                  formControlName="relatorioContratosPendentes" rows="4"
                  placeholder="Adicione observações importantes sobre o contrato, valores pendentes ou outras informações relevantes..."></textarea>
                <small class="form-hint">
                  <i class="bi bi-info-circle me-1"></i>
                  Campo opcional para anotações importantes
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <div class="actions-content">
          <div class="form-validation-summary" *ngIf="clienteForm.invalid && clienteForm.touched">
            <div class="validation-icon">
              <i class="bi bi-exclamation-triangle"></i>
            </div>
            <div class="validation-text">
              <strong>Atenção!</strong> Verifique os campos obrigatórios antes de continuar.
            </div>
          </div>

          <div class="action-buttons">
            <button type="button" class="btn btn-outline-secondary btn-lg" (click)="cancelar()">
              <i class="bi bi-x-circle me-2"></i>
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary btn-lg" [disabled]="isSubmitting || clienteForm.invalid">
              <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2" role="status"></span>
              <i *ngIf="!isSubmitting" class="bi me-2" [class]="isEditMode ? 'bi-check-circle' : 'bi-plus-circle'"></i>
              {{ isSubmitting ? 'Salvando...' : (isEditMode ? 'Atualizar Cliente' : 'Cadastrar Cliente') }}
            </button>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>
