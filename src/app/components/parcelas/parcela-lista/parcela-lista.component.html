<div class="installments-container" *ngIf="cliente">
  <!-- Header Section -->
  <div class="header-section">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-8">
          <div class="client-header-info">
            <div class="client-avatar">
              {{ cliente.nome.charAt(0).toUpperCase() }}
            </div>
            <div class="client-title-info">
              <h1 class="page-title">
                <i class="bi bi-list-ol me-3"></i>
                Parcelas do Cliente
              </h1>
              <p class="page-subtitle">{{ cliente.nome }} - Contrato {{ cliente.compra.numeroContrato }}</p>
            </div>
          </div>
        </div>
        <div class="col-lg-4 text-lg-end">
          <div class="header-actions">
            <button class="btn btn-outline-light btn-lg" (click)="voltar()">
              <i class="bi bi-arrow-left me-2"></i>
              Voltar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container mt-4">
    <!-- Contract Summary -->
    <div class="contract-summary mb-4">
      <div class="summary-grid">
        <div class="summary-item">
          <div class="summary-icon total">
            <i class="bi bi-currency-dollar"></i>
          </div>
          <div class="summary-content">
            <h4>{{ cliente.compra.valorTotal | currency:'BRL':'symbol':'1.0-0':'pt-BR' }}</h4>
            <p>Valor Total</p>
          </div>
        </div>
        <div class="summary-item">
          <div class="summary-icon installments">
            <i class="bi bi-list-ol"></i>
          </div>
          <div class="summary-content">
            <h4>{{ cliente.compra.numeroParcelas }}x</h4>
            <p>Parcelas</p>
          </div>
        </div>
        <div class="summary-item">
          <div class="summary-icon amount">
            <i class="bi bi-cash"></i>
          </div>
          <div class="summary-content">
            <h4>{{ cliente.compra.valorParcela | currency:'BRL':'symbol':'1.0-0':'pt-BR' }}</h4>
            <p>Valor/Parcela</p>
          </div>
        </div>
        <div class="summary-item">
          <div class="summary-icon due">
            <i class="bi bi-calendar-event"></i>
          </div>
          <div class="summary-content">
            <h4>Dia {{ cliente.compra.diaVencimento }}</h4>
            <p>Vencimento</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="parcelas.length === 0" class="empty-state">
      <div class="empty-state-content">
        <div class="empty-state-icon">
          <i class="bi bi-list-ol"></i>
        </div>
        <h3>Nenhuma parcela encontrada</h3>
        <p>As parcelas são geradas automaticamente ao cadastrar o cliente</p>
      </div>
    </div>

    <!-- Installments List -->
    <div class="installments-list" *ngIf="parcelas.length > 0">
      <div class="list-header">
        <h4>
          <i class="bi bi-list-check me-2"></i>
          Parcelas do Contrato
        </h4>
        <div class="progress-info">
          {{ contarPorStatus('pago') }}/{{ parcelas.length }} parcelas pagas
        </div>
      </div>

      <div class="installments-table">
        <div class="table-container">
          <div class="installment-row header-row">
            <div class="col-parcela">Parcela</div>
            <div class="col-vencimento">Vencimento</div>
            <div class="col-valor">Valor</div>
            <div class="col-status">Status</div>
            <div class="col-pagamento">Data Pagamento</div>
            <div class="col-atraso">Atraso</div>
            <div class="col-acoes">Ações</div>
          </div>

          <div class="installment-row data-row" *ngFor="let parcela of parcelas" [class]="'status-' + parcela.status">
            <div class="col-parcela">
              <span class="installment-badge">{{ parcela.numeroParcela }}/{{ cliente.compra.numeroParcelas }}</span>
            </div>
            
            <div class="col-vencimento">
              <div class="cell-content">
                <i class="bi bi-calendar3"></i>
                <span>{{ parcela.dataVencimento | date:'dd/MM/yyyy' }}</span>
              </div>
            </div>
            
            <div class="col-valor">
              <div class="cell-content">
                <i class="bi bi-currency-dollar"></i>
                <span class="amount">{{ parcela.valorParcela | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}</span>
              </div>
            </div>
            
            <div class="col-status">
              <span class="status-badge" [class]="'status-' + parcela.status">
                <i class="bi" [class]="getStatusIcon(parcela.status)"></i>
                {{ getStatusText(parcela.status) }}
              </span>
            </div>
            
            <div class="col-pagamento">
              <div class="cell-content" *ngIf="parcela.dataPagamento">
                <i class="bi bi-check-circle"></i>
                <span>{{ parcela.dataPagamento | date:'dd/MM/yyyy' }}</span>
              </div>
              <span class="no-data" *ngIf="!parcela.dataPagamento">-</span>
            </div>
            
            <div class="col-atraso">
              <span class="delay-badge" *ngIf="parcela.diasAtraso > 0">
                <i class="bi bi-exclamation-triangle"></i>
                {{ parcela.diasAtraso }} dia(s)
              </span>
              <span class="on-time" *ngIf="parcela.diasAtraso === 0">
                <i class="bi bi-check-circle"></i>
                Em dia
              </span>
            </div>
            
            <div class="col-acoes">
              <div class="action-buttons">
                <button class="action-btn pay" (click)="abrirModalPagamento(parcela)"
                  title="Registrar Pagamento" *ngIf="parcela.status !== 'pago'">
                  <i class="bi bi-check-circle"></i>
                </button>
                <div class="paid-indicator" *ngIf="parcela.status === 'pago'">
                  <i class="bi bi-check-circle-fill"></i>
                </div>
                <button class="action-btn edit" (click)="editarDataPagamento(parcela)" title="Gerenciar Parcela">
                  <i class="bi bi-gear"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Installments Summary -->
    <div class="installments-summary" *ngIf="parcelas.length > 0">
      <div class="summary-header">
        <h4>
          <i class="bi bi-graph-up me-2"></i>
          Resumo das Parcelas
        </h4>
      </div>
      
      <div class="summary-stats">
        <div class="stat-card paid">
          <div class="stat-icon">
            <i class="bi bi-check-circle"></i>
          </div>
          <div class="stat-content">
            <h3>{{ contarPorStatus('pago') }}</h3>
            <p>Parcelas Pagas</p>
            <span class="stat-amount">{{ calcularTotalPago() | currency:'BRL':'symbol':'1.0-0':'pt-BR' }}</span>
          </div>
        </div>
        
        <div class="stat-card pending">
          <div class="stat-icon">
            <i class="bi bi-clock"></i>
          </div>
          <div class="stat-content">
            <h3>{{ contarPorStatus('pendente') }}</h3>
            <p>Em Aberto</p>
            <span class="stat-amount">{{ (contarPorStatus('pendente') * cliente.compra.valorParcela) | currency:'BRL':'symbol':'1.0-0':'pt-BR' }}</span>
          </div>
        </div>
        
        <div class="stat-card overdue">
          <div class="stat-icon">
            <i class="bi bi-exclamation-triangle"></i>
          </div>
          <div class="stat-content">
            <h3>{{ contarPorStatus('atrasado') }}</h3>
            <p>Atrasadas</p>
            <span class="stat-amount">{{ (contarPorStatus('atrasado') * cliente.compra.valorParcela) | currency:'BRL':'symbol':'1.0-0':'pt-BR' }}</span>
          </div>
        </div>
        
        <div class="stat-card progress">
          <div class="stat-icon">
            <i class="bi bi-graph-up-arrow"></i>
          </div>
          <div class="stat-content">
            <h3>{{ ((contarPorStatus('pago') / parcelas.length) * 100) | number:'1.0-0' }}%</h3>
            <p>Progresso</p>
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="(contarPorStatus('pago') / parcelas.length) * 100"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Registro de Pagamento -->
<div class="modal fade show d-block" *ngIf="parcelaEditando" style="background-color: rgba(0,0,0,0.5);">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Registrar Pagamento</h5>
        <button type="button" class="btn-close" (click)="cancelarPagamento()"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <p><strong>Cliente:</strong> {{ parcelaEditando.clienteNome }}</p>
          <p><strong>Parcela:</strong> {{ parcelaEditando.numeroParcela }}/{{ cliente?.compra?.numeroParcelas }}</p>
          <p><strong>Vencimento:</strong> {{ parcelaEditando.dataVencimento | date:'dd/MM/yyyy' }}</p>
          <p><strong>Valor da Parcela:</strong> {{ parcelaEditando.valorParcela | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}</p>
        </div>

        <hr>

        <div class="mb-3">
          <label for="dataPagamento" class="form-label">Data do Pagamento *</label>
          <input 
            type="date" 
            class="form-control" 
            id="dataPagamento" 
            [(ngModel)]="dataPagamentoInput"
            required>
        </div>

        <div class="mb-3">
          <label for="valorPago" class="form-label">Valor Pago *</label>
          <div class="input-group">
            <span class="input-group-text">R$</span>
            <input 
              type="number" 
              class="form-control" 
              id="valorPago" 
              [(ngModel)]="valorPagoInput"
              step="0.01"
              required>
          </div>
          <small class="text-muted">Valor padrão: {{ parcelaEditando.valorParcela | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}</small>
        </div>

        <div class="mb-3">
          <label for="observacao" class="form-label">Observação</label>
          <textarea 
            class="form-control" 
            id="observacao" 
            [(ngModel)]="observacaoInput"
            rows="2"
            placeholder="Observação opcional"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cancelarPagamento()">
          Cancelar
        </button>
        <button type="button" class="btn btn-success" (click)="confirmarPagamento()">
          <i class="bi bi-check-circle"></i> Confirmar Pagamento
        </button>
      </div>
    </div>
  </div>
</div>