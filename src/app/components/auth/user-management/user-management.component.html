<div class="container mt-4">
  <div class="header-section">
    <h2>Gerenciamento de Usu√°rios</h2>
    <button class="btn btn-primary" (click)="toggleAddForm()">
      <span *ngIf="!showAddForm">+ Adicionar Usu√°rio</span>
      <span *ngIf="showAddForm">‚úï Cancelar</span>
    </button>
  </div>

  <div class="alert alert-success" *ngIf="successMessage" role="alert">
    {{ successMessage }}
  </div>

  <div class="alert alert-danger" *ngIf="errorMessage" role="alert">
    {{ errorMessage }}
  </div>

  <!-- Formul√°rio de Adicionar Usu√°rio -->
  <div class="add-user-form" *ngIf="showAddForm">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Novo Usu√°rio</h5>
        <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="displayName">Nome Completo *</label>
                <input
                  type="text"
                  id="displayName"
                  class="form-control"
                  formControlName="displayName"
                  placeholder="Nome do usu√°rio"
                  [class.is-invalid]="displayName?.invalid && displayName?.touched"
                />
                <div class="invalid-feedback" *ngIf="displayName?.invalid && displayName?.touched">
                  Nome √© obrigat√≥rio
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-group">
                <label for="email">Email *</label>
                <input
                  type="email"
                  id="email"
                  class="form-control"
                  formControlName="email"
                  placeholder="email@exemplo.com"
                  [class.is-invalid]="email?.invalid && email?.touched"
                />
                <div class="invalid-feedback" *ngIf="email?.invalid && email?.touched">
                  <span *ngIf="email?.errors?.['required']">Email √© obrigat√≥rio</span>
                  <span *ngIf="email?.errors?.['email']">Email inv√°lido</span>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="password">Senha *</label>
                <input
                  type="password"
                  id="password"
                  class="form-control"
                  formControlName="password"
                  placeholder="M√≠nimo 6 caracteres"
                  [class.is-invalid]="password?.invalid && password?.touched"
                />
                <div class="invalid-feedback" *ngIf="password?.invalid && password?.touched">
                  <span *ngIf="password?.errors?.['required']">Senha √© obrigat√≥ria</span>
                  <span *ngIf="password?.errors?.['minlength']">M√≠nimo 6 caracteres</span>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-group">
                <label for="role">Tipo de Usu√°rio *</label>
                <select
                  id="role"
                  class="form-control"
                  formControlName="role"
                >
                  <option [value]="UserRole.COMUM">Comum</option>
                  <option [value]="UserRole.ADMIN">Administrador</option>
                </select>
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-success" [disabled]="loading">
              <span *ngIf="!loading">Criar Usu√°rio</span>
              <span *ngIf="loading">
                <span class="spinner-border spinner-border-sm me-2"></span>
                Criando...
              </span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Lista de Usu√°rios -->
  <div class="users-list mt-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Usu√°rios Cadastrados</h5>
        
        <div *ngIf="loading && users.length === 0" class="text-center py-4">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Carregando...</span>
          </div>
        </div>

        <div *ngIf="!loading && users.length === 0" class="text-center py-4 text-muted">
          Nenhum usu√°rio cadastrado
        </div>

        <div class="table-responsive" *ngIf="users.length > 0">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Nome</th>
                <th>Email</th>
                <th>Tipo</th>
                <th>Status</th>
                <th class="text-center">A√ß√µes</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of users" [class.inactive-row]="!user.active">
                <td>{{ user.displayName }}</td>
                <td>{{ user.email }}</td>
                <td>
                  <span class="badge" [ngClass]="getRoleBadgeClass(user.role)">
                    {{ getRoleLabel(user.role) }}
                  </span>
                </td>
                <td>
                  <span class="badge" [ngClass]="user.active ? 'bg-success' : 'bg-secondary'">
                    {{ user.active ? 'Ativo' : 'Inativo' }}
                  </span>
                </td>
                <td class="text-center">
                  <div class="btn-group btn-group-sm" role="group">
                    <button
                      class="btn btn-outline-warning"
                      (click)="toggleUserStatus(user)"
                      [title]="user.active ? 'Desativar' : 'Ativar'"
                    >
                      {{ user.active ? 'üîí' : 'üîì' }}
                    </button>
                    <button
                      class="btn btn-outline-danger"
                      (click)="deleteUser(user)"
                      title="Deletar"
                    >
                      üóëÔ∏è
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
