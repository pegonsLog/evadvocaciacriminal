<div class="users-container">
  <!-- Header Section -->
  <div class="header-section">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-8">
          <div class="page-header-info">
            
            <div class="page-title-info">
              <h1 class="page-title">
                <i class="bi bi-person-gear me-3"></i>
                Gerenciamento de Usuários
              </h1>
              <p class="page-subtitle">Gerencie usuários e permissões do sistema</p>
            </div>
          </div>
        </div>
        <div class="col-lg-4 text-lg-end">
          <div class="header-actions">
            <button class="btn btn-outline-light btn-lg" (click)="toggleAddForm()">
              <i class="bi" [class]="showAddForm ? 'bi-x-lg' : 'bi-plus-circle'" class="me-2"></i>
              {{ showAddForm ? 'Cancelar' : 'Novo Usuário' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container mt-4">
    <!-- Success/Error Messages -->
    <div class="alert alert-success alert-modern" *ngIf="successMessage" role="alert">
      <i class="bi bi-check-circle-fill me-2"></i>
      {{ successMessage }}
    </div>

    <div class="alert alert-danger alert-modern" *ngIf="errorMessage" role="alert">
      <i class="bi bi-exclamation-triangle-fill me-2"></i>
      {{ errorMessage }}
    </div>

    <!-- Add User Form -->
    <div class="add-user-section" *ngIf="showAddForm">
      <div class="form-card">
        <div class="form-header">
          <div class="form-icon">
            <i class="bi bi-person-plus"></i>
          </div>
          <div class="form-title">
            <h4>Novo Usuário</h4>
            <p>Preencha os dados para criar um novo usuário</p>
          </div>
        </div>

        <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="modern-form">
          <div class="form-grid">
            <div class="form-group">
              <label for="displayName" class="form-label">
                <i class="bi bi-person-badge me-2"></i>
                Nome Completo *
              </label>
              <input
                type="text"
                id="displayName"
                class="form-control"
                formControlName="displayName"
                placeholder="Digite o nome completo"
                [class.is-invalid]="displayName?.invalid && displayName?.touched"
              />
              <div class="invalid-feedback" *ngIf="displayName?.invalid && displayName?.touched">
                <i class="bi bi-exclamation-circle me-1"></i>
                Nome é obrigatório
              </div>
            </div>

            <div class="form-group">
              <label for="email" class="form-label">
                <i class="bi bi-envelope me-2"></i>
                Email *
              </label>
              <input
                type="email"
                id="email"
                class="form-control"
                formControlName="email"
                placeholder="usuario@exemplo.com"
                [class.is-invalid]="email?.invalid && email?.touched"
              />
              <div class="invalid-feedback" *ngIf="email?.invalid && email?.touched">
                <i class="bi bi-exclamation-circle me-1"></i>
                <span *ngIf="email?.errors?.['required']">Email é obrigatório</span>
                <span *ngIf="email?.errors?.['email']">Email inválido</span>
              </div>
            </div>

            <div class="form-group">
              <label for="password" class="form-label">
                <i class="bi bi-lock me-2"></i>
                Senha *
              </label>
              <input
                type="password"
                id="password"
                class="form-control"
                formControlName="password"
                placeholder="Mínimo 6 caracteres"
                [class.is-invalid]="password?.invalid && password?.touched"
              />
              <div class="invalid-feedback" *ngIf="password?.invalid && password?.touched">
                <i class="bi bi-exclamation-circle me-1"></i>
                <span *ngIf="password?.errors?.['required']">Senha é obrigatória</span>
                <span *ngIf="password?.errors?.['minlength']">Mínimo 6 caracteres</span>
              </div>
            </div>

            <div class="form-group">
              <label for="role" class="form-label">
                <i class="bi bi-shield-check me-2"></i>
                Tipo de Usuário *
              </label>
              <select id="role" class="form-control" formControlName="role">
                <option [value]="UserRole.COMUM">Usuário Comum</option>
                <option [value]="UserRole.ADMIN">Administrador</option>
              </select>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="toggleAddForm()">
              <i class="bi bi-x-circle me-2"></i>
              Cancelar
            </button>
            <button type="submit" class="btn btn-success" [disabled]="loading || userForm.invalid">
              <span *ngIf="!loading">
                <i class="bi bi-check-circle me-2"></i>
                Criar Usuário
              </span>
              <span *ngIf="loading">
                <span class="spinner-border spinner-border-sm me-2"></span>
                Criando...
              </span>
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Users List -->
    <div class="users-list-section">
      <div class="list-header">
        <h4>
          <i class="bi bi-people me-2"></i>
          Usuários Cadastrados
        </h4>
        <div class="users-count" *ngIf="users.length > 0">
          {{ users.length }} usuário(s) cadastrado(s)
        </div>
      </div>

      <!-- Loading State -->
      <div *ngIf="loading && users.length === 0" class="loading-state">
        <div class="loading-content">
          <div class="loading-spinner">
            <div class="spinner-border text-primary"></div>
          </div>
          <p>Carregando usuários...</p>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!loading && users.length === 0" class="empty-state">
        <div class="empty-state-content">
          <div class="empty-state-icon">
            <i class="bi bi-people"></i>
          </div>
          <h3>Nenhum usuário cadastrado</h3>
          <p>Comece adicionando o primeiro usuário ao sistema</p>
          <button class="btn btn-primary btn-lg" (click)="toggleAddForm()">
            <i class="bi bi-plus-circle me-2"></i>
            Adicionar Primeiro Usuário
          </button>
        </div>
      </div>

      <!-- Users Table -->
      <div class="users-table" *ngIf="users.length > 0">
        <div class="table-container">
          <div class="user-row header-row">
            <div class="col-user">Usuário</div>
            <div class="col-email">Email</div>
            <div class="col-role">Tipo</div>
            <div class="col-status">Status</div>
            <div class="col-actions">Ações</div>
          </div>

          <div class="user-row data-row" *ngFor="let user of users" [class]="'status-' + (user.active ? 'active' : 'inactive')">
            <div class="col-user">
              <div class="user-info">
                <div class="user-avatar">
                  <i class="bi bi-person-circle"></i>
                </div>
                <div class="user-details">
                  <span class="user-name">{{ user.displayName }}</span>
                  <span class="user-id" *ngIf="user.uid">ID: {{ user.uid.substring(0, 8) }}...</span>
                </div>
              </div>
            </div>
            
            <div class="col-email">
              <div class="cell-content">
                <i class="bi bi-envelope"></i>
                <span>{{ user.email }}</span>
              </div>
            </div>
            
            <div class="col-role">
              <span class="role-badge" [class]="'role-' + user.role.toLowerCase()">
                <i class="bi" [class]="user.role === UserRole.ADMIN ? 'bi-shield-fill' : 'bi-person-fill'"></i>
                {{ getRoleLabel(user.role) }}
              </span>
            </div>
            
            <div class="col-status">
              <span class="status-badge" [class]="'status-' + (user.active ? 'active' : 'inactive')">
                <i class="bi" [class]="user.active ? 'bi-check-circle-fill' : 'bi-x-circle-fill'"></i>
                {{ user.active ? 'Ativo' : 'Inativo' }}
              </span>
            </div>
            
            <div class="col-actions">
              <div class="action-buttons">
                <button 
                  class="action-btn toggle" 
                  (click)="toggleUserStatus(user)"
                  [title]="user.active ? 'Desativar usuário' : 'Ativar usuário'">
                  <i class="bi" [class]="user.active ? 'bi-lock' : 'bi-unlock'"></i>
                </button>
                <button 
                  class="action-btn delete" 
                  (click)="deleteUser(user)"
                  title="Excluir usuário">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>